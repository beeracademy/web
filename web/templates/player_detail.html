{% extends "container.html" %}

{% load humanize %}

{% block pagetitle %}Player {{ object.username }}{% endblock %}

{% block content %}

<h2>
	{% if object.is_staff %}
	<i class="fas fa-crown" style="color: #dc3545;"></i>
	{% endif %}

	{{ object.username }} 

	{% if object == user %}
		<a class="btn btn-primary float-right text-light col-md-auto" href="/settings/">Profile settings</a>
		<br><br class="d-lg-none">
	{% endif %}
	{% if user.is_staff and object != user %}
		<a class="btn btn-primary float-right text-light col-md-auto" href="/admin/games/user/{{ object.id }}/change/">Edit</a>
		<br><br class="d-lg-none">
	{% endif %}
</h2>

<hr>

<div class="row">
	<div class="col-md-auto text-center">
		<img src="{{ object.image_url }}" alt="Profile picture" class="rounded">
	</div>
	<div class="col-md-10 d-none d-lg-block">
		<div style="display: flex; align-items: center; height: 100%;">
			<div id="heatmap" style="width: 100%;"></div>
		</div>
	</div>
</div>

<br>

<h4><i class="fas fa-trophy"></i>  Achievements</h4>

<hr>

<div class="container">
	<div class="row achievements">
		{% for achievement in achievements %}
			<img class="rounder{% if achievement.achieved %} active{% endif %}" src="{{ achievement.icon_url }}" title="{{ achievement.name }}: {{ achievement.description }}">
		{% endfor %}
	</div>
</div>

<br>

<h4>
	<i class="fas fa-receipt"></i> Rank

	<div style="float: right; margin-top: -7px;">
		{% include "season_chooser.html" %}
	</div>
</h4>

<hr>

<div class="container">
	<div class="row">
		{% for ranking in rankings %}
		<div class="card col-md-2 ml-auto mr-auto">
			<div class="card-body text-center">
				<p class="card-title mb-2">{{ ranking.name }}</p>
				<h4 class="card-text">{% spaceless %}
					{% if ranking.rank %}
						<a href="{{ ranking.url }}">#{{ ranking.rank }}</a>
					{% else %}
						-
					{% endif %}
					{% endspaceless %}</h4>
			</div>
		</div>
		{% endfor %}
	</div>
</div>

<br>

<h4><i class="fas fa-chart-pie"></i> Stats</h4>

<hr>

<div class="row">
	<div class="col-md-6">
		<table class="table table-bordered table-striped table-sm">
			<tbody>
				<tr>
					<th>Games played</th>
					<td>{{ stats.total_games|intcomma }}</td>
				</tr>
				<tr>
					<th>Total time played</th>
					<td>{{ stats.total_time_played }}
						<br>
						(~ {{ stats.approx_ects|floatformat:1 }} ECTS)</td>
				</tr>
				<tr>
					<th>Estimated money spent (TÅGEKAMMERET)</th>
					<td>{{ stats.approx_money_spent_tk|intcomma }}</td>
				</tr>
				<tr>
					<th>Estimated money spent (FøTeX)</th>
					<td>{{ stats.approx_money_spent_føtex|intcomma }}</td>
				</tr>
			</tbody>
		</table>
	</div>
	<div class="col-md-6">
		<table class="table table-bordered table-striped table-sm">
			<tbody>
				<tr>
					<th>Total sips</th>
					<td>{{ stats.total_sips|intcomma }} ({{ stats.total_beers|floatformat:0|intcomma }} beers)</td>
				</tr>
				<tr>
					<th>Best game</th>
					<td>{% include "utils/link.html" with text=stats.best_game_sips prefix="/games" id=stats.best_game.id %}
					</td>
				</tr>
				<tr>
					<th>Worst game</th>
					<td>{% include "utils/link.html" with text=stats.worst_game_sips prefix="/games" id=stats.worst_game.id %}
					</td>
				</tr>
				<tr>
					<th>Average game</th>
					<td>{% firstof stats.average_game_sips "-" %}</a></td>
				</tr>
				<tr>
					<th>Total chugs</th>
					<td>{{ stats.total_chugs|intcomma }}</td>
				</tr>
				<tr>
					<th>Fastest chug time</th>
					<td>{% include "utils/link.html" with text=stats.fastest_chug.duration prefix="/games" id=stats.fastest_chug.card.game.id %}
					</td>
				</tr>
				<tr>
					<th>Average chug time</th>
					<td>{% firstof stats.average_chug_time "-" %}</td>
				</tr>
			</tbody>
		</table>
	</div>
</div>

{% endblock %}

{% block scripts %}
{{ heatmap_data|json_script:"heatmap_data" }}

<script>
	var data = JSON.parse(document.getElementById("heatmap_data").textContent);

	var options = {
		series: data.series,
		xaxis: {
			categories: data.categories,
		},
		grid: {
			position: 'front',
			xaxis: {
				lines: {
					show: true,
				},
			},
			yaxis: {
				lines: {
					show: true,
				},
			},
		},
		tooltip: {
			y: {
				formatter: function(value, args) {
					var games = value === 1? "game": "games";
					return value + " " + games + " played";
				},
				title: {
					formatter: function(value, args) {
						return data.dates[args.seriesIndex][args.dataPointIndex];
						return value;
					},
				},
			},
		},
		chart: {
			height: 200,
			type: 'heatmap',
		},
		dataLabels: {
			enabled: false
		},
		colors: ["#008FFB"],
	};

	var chart = new ApexCharts(document.getElementById("heatmap"), options);
	chart.render();
</script>
{% endblock %}
